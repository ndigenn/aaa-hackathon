Original prompt: Can you add the summonpage.png to the background of the summon page and the homepage.png to the home page on the app. Try to make the scaling images fit well, make design changes that you would believe would work best

- Located relevant pages: src/app/home/page.tsx and src/app/summon/page.tsx.
- Confirmed assets exist: public/homepage.png and public/summonpage.png.
- Plan: replace gradient page backgrounds with image backgrounds, add contrast overlays, and tune responsive positioning/spacing for readability.
- Implemented image backgrounds:
  - Home uses `/homepage.png` with `bg-cover bg-center` and layered dark gradients for text contrast.
  - Summon uses `/summonpage.png` with `bg-cover bg-center` and medium-screen offset positioning plus side-vignette overlays.
- Updated content card surfaces to darker translucent gradients so foreground text remains readable over artwork.
- Validation:
  - `npm run lint` passed.
  - Installed Playwright Chromium and ran skill client captures for `/home` and `/summon` into `output/web-game-home` and `output/web-game-summon`.
  - Both captures redirect to Auth0 login in this environment, so direct visual verification of in-app background pages was blocked by authentication.
- Note: `package.json` and `package-lock.json` include Playwright dependency updates from setup.
- Cleaned temporary local validation artifacts (`output/`, `web_game_playwright_client.local.js`) after verification run.

- New request handled: fix summon failure (500: "Summon failed. Please try again.") and reduce summon to one banner.
- Root cause identified in `src/lib/summon.ts`: update uses `ADD ownedCardIds :set` (String Set). Existing user records can have `ownedCardIds` stored as a List from prior writes, which causes DynamoDB `ValidationException` and falls into the generic 500 handler.
- Fix implemented:
  - Keep set-based update path as primary.
  - On `ValidationException`, retry with list-based update using `list_append(if_not_exists(ownedCardIds, :emptyList), :newOwnedCardIds)` and same coin deduction condition.
  - Preserve insufficient coin behavior in fallback by mapping `ConditionalCheckFailedException` to `SummonError(INSUFFICIENT_COINS)`.
- Banner simplification to single banner:
  - `src/lib/summon.ts`: `BannerId` narrowed to only `"outlaw-legend"`; pool now includes all card IDs 1-10.
  - `src/components/summon/summon-banners.tsx`: removed second banner card; updated copy to single featured banner.
  - `src/app/summon/page.tsx`: heading/subtitle updated to singular banner copy.
- Validation:
  - `npm run lint` passes.
  - Ran Playwright client loop via local copy of skill script against `/summon`; screenshots generated, but route redirects to Auth0 login in this environment so in-app summon interaction could not be exercised here.
- Cleanup: removed temporary local Playwright helper/action files and temporary screenshot output after verification.
- Follow-up request handled: fix shop purchase failing with DynamoDB ValidationException (key does not match schema).
- Root cause: `src/lib/shop.ts` used fixed key `{ PK, SK }`, but active `Users` table profile rows may be keyed differently (`id`, `userId`, or `sub`).
- Shop fix (`src/lib/shop.ts`):
  - Added key-schema-tolerant fallback flow.
  - On `ValidationException` from PK/SK update, scan by auth user id (`userId` OR `sub` OR `id`) to locate record.
  - Build key candidates from located record (`PK/SK`, `id`, `userId`, `sub`) and retry update until one matches table schema.
  - Preserve error mapping: missing profile -> `ShopError(USER_NOT_FOUND)`.
- Additional hardening (`src/lib/summon.ts`):
  - Applied the same key-schema-tolerant key resolution path for summon updates.
  - Existing list-vs-set `ownedCardIds` fallback remains; now works across non-PK/SK schemas too.
- Validation: `npm run lint` passes after changes.
- Audio request implemented:
  - Added `public/door.mp3` alias by copying existing `Door Opening Sound Effect.mp3` so requested filename is available.
  - Bottom nav now plays one-shot tab SFX on click:
    - Summon tab -> `/door.mp3` at volume `0.30`
    - Shop tab -> `/coin.mp3` at volume `0.45`
  - Added `src/components/summon/summon-audio.tsx` and mounted it on summon page so `/pianoSaloon.mp3` loops while on summon page at volume `0.22`.
  - Summon background music retries once on first pointer/key interaction if autoplay is blocked.
- Validation: `npm run lint` passes.
- Summon audio balancing update:
  - Added summon music ducking event flow.
  - `src/components/summon/summon-banners.tsx` now dispatches `summon:music-duck` with `{ ducked: true }` when summon starts, and restores with `{ ducked: false }` on summon failure, reveal close, voice-line end/error, and unmount cleanup.
  - `src/components/summon/summon-audio.tsx` listens for `summon:music-duck` and adjusts BGM volume from `0.22` (normal) to `0.10` (ducked).
- Validation: `npm run lint` passes.
- Duplicate summon refund implemented:
  - Added `DUPLICATE_SUMMON_REFUND = 500` and `DUPLICATE_SUMMON_COST = 500` in `src/lib/summon.ts`.
  - Summon now checks whether the drawn card is already owned (`ownedCardIds` list or set).
  - Duplicate pull path deducts only 500 coins and does not re-add the card.
  - Non-duplicate path remains 1000 coins and adds card to ownership.
  - Response now includes `refundedCoins` and `isDuplicate` for duplicate pulls.
- Summon reveal UI now displays duplicate refund text when applicable.
- Validation: `npm run lint` passes.
- Duplicate refund bugfix:
  - Removed strict `contains(ownedCardIds, :drawnCardId)` conditions from summon update queries, which could fail on mixed legacy `ownedCardIds` shapes/types and cause duplicate summons to error.
  - Duplicate path now uses pre-read ownership detection and applies net duplicate cost (500) via coin-only update.
  - Non-duplicate path continues to charge full cost and add card ownership.
  - Expanded profile scan fallback to also accept lowercase `profile` SK variants.
- Validation: `npm run lint` passes.
- Summon duplicate refund hotfix (second pass):
  - Added a robust scan+put summon write path in `src/lib/summon.ts`.
  - If a profile record is found via scan, summon logic now computes duplicate status and cost in code, then writes back with `PutCommand` using the discovered record shape.
  - This bypasses DynamoDB key-shape/update-expression edge cases that were still causing generic summon failures on duplicate pulls.
  - Duplicate behavior: charge 500, keep ownership unchanged.
  - Non-duplicate behavior: charge 1000, append/add ownership.
- Validation: `npm run lint` passes.
- New feature: implemented simple 3v3 battle system.
- Added new route `src/app/battle/page.tsx` and client battlefield `src/components/battle/battle-page-client.tsx`.
- Battle flow:
  - Uses 3 selected player cards (from `loadout` query string) vs 3 generic enemy cards.
  - Player phase: drag player cards onto enemy cards (or select + click target) to attack.
  - Each living player card acts once per turn.
  - Enemy phase: living enemies auto-attack random living player units.
  - Win/loss detection, battle log, reset button, and turn counter included.
- Basic card abilities added by card type:
  - `Healer`: heals lowest ally on attack.
  - `Support`: buffs ally attack.
  - `Debuffer`: applies vulnerable to target.
  - `Tank`: reduced damage but self-heal.
  - `DPS/Sub DPS`: deterministic crit-trigger burst strike.
- Hooked Home loadout battle button to open `/battle?loadout=<id,id,id>` with guard when fewer than 3 cards selected (`src/components/home/home-loadout-client.tsx`).
- Validation:
  - `npm run lint` passes.
  - Playwright smoke run executed for `/battle`; environment redirects to Auth0 login here, so direct in-battle visual validation was blocked in this environment.
